<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{partials :: head ('Posts')}">
</head>
<body>
<nav th:replace="partials :: navbar"></nav>
<div class="main-container">
    <div class="text-container">
    <h1><span th:text="${team.city} + ' ' + ${team.name}"></span></h1>
    <div>
        <ul>
           <li th:each="user : ${team.users}">
               <button th:text="${user.firstName}" type="button" class="btn btn-secondary"
                       data-bs-toggle="popover" data-bs-placement="right"
                       data-bs-custom-class="custom-popover"
                       data-bs-title="Custom popover"
                       data-bs-content="This popover is themed via CSS variables.">
               </button>
           </li>
        </ul>
    </div>
        <form method="post" th:action="@{/teams/{id}/posts/create(id=${team.id})}">
            <div class="mb-3">
                <label for="title" class="form-label">Title:</label>
                <input type="text" class="form-control" id="title" name="title" required>
            </div>
            <div class="mb-3">
                <label for="content" class="form-label">Content:</label>
                <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Create Post</button>
        </form>

        <ul>
            <li th:each="post : ${posts}">
                <div th:id="'post-' + ${post.id}">

                    <h3 th:text="${post.title}" class="post-title"></h3>
                    <form th:action="@{/teams/{id}/posts/{postId}/edit(id=${team.id}, postId=${post.id})}" method="post" class="save-form">
                        <label class="title-label" for="post-title">Title</label>
                        <input th:value="${post.title}" id="post-title" name="post-title" type="text" class="title-input">

                        <p th:text="${post.content}" class="post-content"></p>
                        <label class="content-label" for="post-content">Content</label>
                        <textarea th:text="${post.content}" id="post-content" name="post-content" rows="5" type="text" class="content-textarea"></textarea>

                        <p th:text="'Created By ' + ${post.user.firstName} + ' at ' + ${post.timestamp}"></p>

                        <button class="btn btn-light save-button" th:if="${post.user.username} == ${#authentication.principal.username}">Save</button>
                    </form>
                    <button th:if="${post.user.username == #authentication.principal.username}" th:onclick="'toggleEdit(' + ${post.id} + ')'" class="btn btn-secondary edit-button">Edit</button>

                    <form th:action="@{/teams/{id}/posts/{postId}/delete(id=${team.id}, postId=${post.id})}" method="post">
                        <button class="btn btn-danger" th:if="${post.user.username} == ${#authentication.principal.username}">Delete</button>
                    </form>
                    <hr>
                </div>
            </li>
        </ul>
    </div>
</div>
<footer th:replace="partials :: footer"></footer>
<div th:replace="partials :: js"></div>
</body>
</html>